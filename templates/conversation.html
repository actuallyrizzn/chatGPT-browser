{% extends "base.html" %}

{% block content %}
<div class="conversation {% if dark_mode %}dark{% endif %}">
    <h1>{{ conversation.title }}</h1>
    
    {% for message in messages %}
        <div class="message {% if message.role == 'assistant' %}assistant{% else %}user{% endif %}">
            <div class="message-header">
                {% if message.role == 'assistant' %}
                    <strong>{{ assistant_name }}</strong>
                {% else %}
                    <strong>{{ user_name }}</strong>
                {% endif %}
                {% if dev_mode %}
                    <span class="metadata">
                        ({{ message.create_time }})
                    </span>
                {% endif %}
            </div>
            
            <div class="message-content">
                {% set content = message.content|fromjson %}
                {% for part in content %}
                    {% if part is string %}
                        {{ part|markdown|safe }}
                    {% else %}
                        <pre><code>{{ part|tojson(indent=2) }}</code></pre>
                    {% endif %}
                {% endfor %}
            </div>
            
            {% if dev_mode %}
                <div class="message-metadata">
                    <details>
                        <summary>Metadata</summary>
                        <pre>Message ID: {{ message.id }}
Parent ID: {{ message.parent_id }}
Role: {{ message.role }}
Content Type: {{ message.content_type }}
Create Time: {{ message.create_time|datetime }}
Update Time: {{ message.update_time|datetime }}
{% if message.metadata %}
Message Type: {{ message.metadata.message_type }}
Model Slug: {{ message.metadata.model_slug }}
Citations: {{ message.metadata.citations|tojson(indent=2) }}
Content References: {{ message.metadata.content_references|tojson(indent=2) }}
Finish Details: {{ message.metadata.finish_details|tojson(indent=2) }}
Is Complete: {{ message.metadata.is_complete }}
Request ID: {{ message.metadata.request_id }}
Timestamp: {{ message.metadata.timestamp_|datetime }}
Message Source: {{ message.metadata.message_source }}
Serialization Metadata: {{ message.metadata.serialization_metadata|tojson(indent=2) }}
{% endif %}</pre>
                    </details>
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% endblock %} 